CREATE TABLE CUSTOMER (
	CID NVARCHAR2(20) PRIMARY KEY,
	CNAME NVARCHAR2(200) NOT NULL,
	CADDRESS NVARCHAR2(200)
);

--시퀀스는 PK에 순차적인 인덱스를 위해 사용하는거라서,
--직접 키값을 입력해서 주는거면 굳이 할 필요 X
CREATE SEQUENCE SEQ_CUSTOMER;
--DROP SEQUENCE SEQ_CUSTOMER;

CREATE TABLE JUMUN(
	JID NUMBER PRIMARY KEY,
	CID NVARCHAR2(20),
	FOREIGN KEY (CID) REFERENCES CUSTOMER (CID)
);
--DROP SEQUENCE SEQ_JUMUN;
CREATE SEQUENCE SEQ_JUMUN
		START WITH 101;

CREATE TABLE PRODUCT(
	PID NVARCHAR2(20) PRIMARY KEY,
	PNAME NVARCHAR2(200),
	PPRICE NVARCHAR2(20)
);

-- 칼럼 수정
ALTER TABLE PRODUCT MODIFY PNAME NVARCHAR2(200) NOT NULL;
--ALTER TABLE PRODUCT MODIFY PPRICE NUMBER;

CREATE SEQUENCE SEQ_PRODUCT;

CREATE TABLE JUMUNPRODUCT(
	JAMOUNT NUMBER,
	JID NUMBER,
	PID NVARCHAR2(20),
	FOREIGN KEY (JID) REFERENCES JUMUN (JID),
	FOREIGN KEY (PID) REFERENCES PRODUCT (PID)
);

--DELETE FROM CUSTOMER;
INSERT INTO CUSTOMER 
VALUES('C'||LPAD(SEQ_CUSTOMER.NEXTVAL, 3, '0'), '김철수','강남구');

INSERT INTO CUSTOMER 
VALUES('C'||LPAD(SEQ_CUSTOMER.NEXTVAL, 3, '0'), '이영희','해운대구');
COMMIT;
SELECT * FROM CUSTOMER;

INSERT INTO PRODUCT
VALUES('P'||LPAD(SEQ_PRODUCT.NEXTVAL, 3, '0'), '노트북', '120만');

INSERT INTO PRODUCT
VALUES('P'||LPAD(SEQ_PRODUCT.NEXTVAL, 3, '0'), '마우스', '2만');

INSERT INTO PRODUCT
VALUES('P'||LPAD(SEQ_PRODUCT.NEXTVAL, 3, '0'), '키보드', '3만');

COMMIT;
SELECT * FROM PRODUCT;

-- CUSTOMER_ID의 인덱싱이 숫자가 아니라 문자+숫자이면 어떻게 자동 생성이 되는거지?
INSERT INTO JUMUN VALUES(SEQ_JUMUN.NEXTVAL, 'C001');
INSERT INTO JUMUN VALUES(SEQ_JUMUN.NEXTVAL, 'C002');
INSERT INTO JUMUN VALUES(SEQ_JUMUN.NEXTVAL, 'C001');
COMMIT;
SELECT * FROM JUMUN;

INSERT INTO JUMUNPRODUCT VALUES(1, 101, 'P001');
INSERT INTO JUMUNPRODUCT VALUES(2, 101, 'P002');
INSERT INTO JUMUNPRODUCT VALUES(1, 102, 'P003');
INSERT INTO JUMUNPRODUCT VALUES(1, 103, 'P001');
COMMIT;
SELECT * FROM JUMUNPRODUCT;

-- GRANT CREATE VIEW TO SCORE;***********
CREATE OR REPLACE VIEW VW_JUMUN_INFO
AS 
SELECT C.CID, C.CNAME, C.CADDRESS, J.JID, P.PID,P.PNAME, P.PPRICE
FROM JUMUN J 
JOIN CUSTOMER C ON J.CID = C.CID
JOIN JUMUNPRODUCT JP ON JP.JID = J.JID
JOIN PRODUCT P ON JP.PID = P.PID;

-- 뷰를 통해서 데이터 조회
SELECT * FROM VW_JUMUN_INFO;
